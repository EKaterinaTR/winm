# Оценка готовности проекта WinM к требованиям курса «Проектирование и разработка распределенных программных систем»

Оценка по состоянию репозитория (ветка k8s). Максимум за техническое соответствие — **60 баллов**, за защиту — **40 баллов**.

*Последнее обновление:* учтены Helm-чарт `helm/winm`, ArgoCD `argocd/application.yaml`, CI с сборкой и пушем образов в GHCR.

---

## 1. Техническое соответствие (до 60 баллов)

### 1.1 Несколько микросервисов (рекомендуется не менее 3)

| Требование | Статус | Комментарий |
|------------|--------|-------------|
| Минимум 3 микросервиса | ❌ Не выполнено | Сейчас два прикладных сервиса: **server** (FastAPI) и **consumer** (обработчик очереди). Neo4j, RabbitMQ, Prometheus считаются инфраструктурой, а не микросервисами проекта. |

**Рекомендация:** Добавить третий сервис (например, отдельный сервис метрик/агрегации, экспортера в Git, или BFF для LLM), либо явно выделить в «микросервисы» три компонента (например, server + consumer + «сервис экспорта» в отдельном деплое).

---

### 1.2 Развёртывание в Kubernetes через Helm

| Требование | Статус | Комментарий |
|------------|--------|-------------|
| Все компоненты в K8s | ✅ Выполнено | Deployment (server, consumer), Service, Secret, namespace — в Helm и в `k8s/`. |
| Через Helm | ✅ Выполнено | Чарт `helm/winm`: Chart.yaml, values.yaml, templates/. Деплой: `helm upgrade --install winm ./helm/winm -n winm --create-namespace`. |

**Рекомендация:** Оформить один или несколько Helm-чартов (например, общий чарт `winm` с subchart’ами или отдельные чарты для server/consumer), деплой делать через `helm install`/`helm upgrade`.

---

### 1.3 GitOps-деплой (ArgoCD)

| Требование | Статус | Комментарий |
|------------|--------|-------------|
| GitOps (ArgoCD и т.п.) | ✅ Выполнено | `argocd/application.yaml`: Application для `helm/winm`, auto-sync, selfHeal, prune. README в `argocd/`. |

**Рекомендация:** Подставить реальный `repoURL` в Application и при необходимости параметры образов (imageRegistry, tag).

---

### 1.4 CI/CD-пайплайн (сборка образов, публикация в registry)

| Требование | Статус | Комментарий |
|------------|--------|-------------|
| CI (тесты) | ✅ Выполнено | GitHub Actions: тесты server и consumer с покрытием. |
| Сборка образов и пуш в registry | ✅ Выполнено | Job `build-and-push` после тестов: сборка и пуш `winm-server` и `winm-consumer` в GHCR (теги: short SHA и `latest`), при push в main/master. |

---

### 1.5 Секреты и конфигурации (ConfigMap, Secret, sealed-secrets)

| Требование | Статус | Комментарий |
|------------|--------|-------------|
| Secret | ✅ Выполнено | Используется `winm-secrets` (Opaque), подключение через `secretKeyRef` в Deployment (neo4j-password, rabbitmq-url, gigachat-credentials). |
| ConfigMap | ⚠️ Не используется | Конфигурация передаётся через env из Secret и захардкоженные value; отдельного ConfigMap нет. |
| Sealed Secrets / External Secrets | ❌ Не выполнено | Не используются (для курса может быть достаточно обычного Secret + инструкции не коммитить реальные значения). |

**Рекомендация:** При необходимости вынести неизменяемую конфигурацию (URLs, имена очередей) в ConfigMap; для GitOps с хранением манифестов в Git рассмотреть Sealed Secrets или External Secrets.

---

### 1.6 Безопасность (RBAC, HTTPS, JWT)

| Требование | Статус | Комментарий |
|------------|--------|-------------|
| RBAC / разграничение прав | ❌ Не выполнено | Нет Role/RoleBinding/ServiceAccount для ограничения прав подов приложения. |
| HTTPS / TLS | ❌ Не выполнено | Ingress не описан; доступ к API предполагается через port-forward или внутренний ClusterIP. |
| JWT / аутентификация API | ❌ Не выполнено | В коде и манифестах явной JWT-аутентификации не видно. |

**Рекомендация:** Добавить ServiceAccount для server/consumer, минимальные Role/RoleBinding; описать Ingress с TLS (например, cert-manager + Let’s Encrypt); при требовании курса — добавить JWT в API (middleware на ключевых эндпоинтах).

---

### 1.7 Масштабирование и отказоустойчивость (HPA, probes, retry/fallback)

| Требование | Статус | Комментарий |
|------------|--------|-------------|
| HPA | ❌ Не выполнено | HorizontalPodAutoscaler не настроен. |
| Probes | ⚠️ Частично | У **server** есть livenessProbe и readinessProbe по `/health`. У **consumer** проб нет. |
| retry/fallback | ❌ Не выполнено | В коде server/consumer явных retry (tenacity, backoff) или circuit breaker не найдено. |

**Рекомендация:** Добавить HPA для server (и при необходимости для consumer) по CPU/памяти или custom metrics; добавить liveness/readiness для consumer (например, по HTTP или exec); реализовать retry при работе с Neo4j/RabbitMQ и при желании — простой circuit breaker (или упомянуть в докладе).

---

### 1.8 Chaos Engineering

| Требование | Статус | Комментарий |
|------------|--------|-------------|
| Минимум один эксперимент (Chaos Mesh и т.п.) | ❌ Не выполнено | В репозитории нет манифестов и описаний экспериментов Chaos Mesh/LitmusChaos (pod kill, network delay, stress и т.д.). |

**Рекомендация:** Установить Chaos Mesh (или аналог), провести один–два воспроизводимых эксперимента (например, pod failure для consumer или network delay), описать сценарий и ожидаемое поведение (HPA, перезапуск, сохранение данных) в документации.

---

### 1.9 Взаимодействие между сервисами (Pub/Sub, Kafka или другой брокер)

| Требование | Статус | Комментарий |
|------------|--------|-------------|
| Брокер сообщений | ✅ Выполнено | Используется **RabbitMQ** (альтернатива Kafka из формулировки «Kafka/Zookeeper или другой брокер»). |
| Взаимодействие сервисов | ✅ Выполнено | Server публикует события в очередь, consumer обрабатывает их и пишет в Neo4j — типичный Pub/Sub между двумя микросервисами. |

---

### 1.10 Документация

| Требование | Статус | Комментарий |
|------------|--------|-------------|
| Инструкция по запуску | ✅ Выполнено | README: локальный запуск (Docker Compose, вариант с хоста), описание API, тесты. |
| Описание архитектуры | ✅ Выполнено | README, ARCHITECTURE_REVIEW.md, AGENTS.md, docs/METRICS.md. |
| Список участников | ❌ Не выполнено | Отдельного списка участников команды с ролями/вкладом в репозитории нет. |

**Рекомендация:** Добавить в README или отдельный файл (например, `CONTRIBUTORS.md`) список участников и кратко — кто за что отвечал (сервисы, K8s, CI/CD, Chaos и т.д.).

---

## 2. Сводная таблица по техническим требованиям

| Критерий | Выполнено | Частично | Не выполнено |
|----------|-----------|----------|--------------|
| Минимум 3 микросервиса | | | ❌ |
| K8s через Helm | ✅ | | |
| GitOps (ArgoCD) | ✅ | | |
| CI/CD (образы + registry) | ✅ | | |
| Secrets / ConfigMap | ✅ | ConfigMap — | |
| RBAC, HTTPS, JWT | | | ❌ |
| HPA, probes, retry/fallback | | probes у server ✅ | HPA, consumer probes, retry/circuit ❌ |
| Chaos Engineering | | | ❌ |
| Брокер (Kafka/другой) и взаимодействие | ✅ | | |
| Документация | ✅ (запуск, архитектура) | | Список участников ❌ |

---

## 3. Ориентировочная оценка по техническому соответствию

Оценка дана с учётом формулировки «частичное выполнение снижает оценку пропорционально».

- **Микросервисы (3+):** ~0 из ~8 (только 2 прикладных сервиса).
- **Helm:** ~8 из ~8 ✅
- **GitOps:** ~8 из ~8 ✅
- **CI/CD (образы + registry):** ~8 из ~8 ✅
- **Secrets/конфиг:** ~5 из ~5 ✅
- **Безопасность (RBAC, HTTPS, JWT):** 0 из ~5.
- **HPA, probes, retry/circuit:** ~2 из ~6 (probes только у server; у consumer нет проб, нет HPA, нет retry/circuit breaker).
- **Chaos Engineering:** 0 из ~5.
- **Брокер и взаимодействие:** ~5 из ~5 ✅
- **Документация:** ~3 из ~5 (нет списка участников).

**Ориентир: порядка 39–42 из 60** по технической части при текущем состоянии. Для «удовлетворительно» (55+) в сумме с защитой (до 40) нужно ещё ~15+ баллов по технике или сильная защита. Для «хорошо» (70+) — доработка третьего сервиса, HPA, probes у consumer, безопасность, Chaos.

---

## 4. Что сделать в приоритете для повышения балла

1. **Третий микросервис** — выделить или добавить сервис (отдельный деплой в K8s), чтобы было не менее трёх прикладных компонентов.
2. ~~**Helm**~~ — ✅ сделано.
3. ~~**GitOps**~~ — ✅ сделано.
4. ~~**CI/CD (образы + registry)**~~ — ✅ сделано.
5. **HPA** — минимум для server (и при необходимости для consumer).
6. **Probes для consumer** — liveness/readiness (HTTP или exec).
7. **Chaos Engineering** — один воспроизводимый эксперимент (Chaos Mesh и т.п.) с кратким описанием.
8. **Безопасность** — как минимум RBAC (ServiceAccount, Role, RoleBinding); при требовании — Ingress с TLS и/или JWT.
9. **Список участников** — в README или CONTRIBUTORS.md.

После выполнения этих пунктов проект будет существенно ближе к полному соответствию требованиям курса и к более высокой оценке на защите.
